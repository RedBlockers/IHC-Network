<!DOCTYPE html>
<html lang="fr">
    <head>
        <link rel="icon" href="./images/NoScord.jpg" />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/default.min.css"
        />
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>NoScord</title>
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css"
            rel="stylesheet"
        />
        <link href="/style/dropZone.css" rel="stylesheet" />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link href="/style/mainPage.css" rel="stylesheet" />
        <link href="/style/contextMenu.css" rel="stylesheet" />
        <link
            href="/js/libraries/styled-notifications-master/dist/notifications.css"
            rel="stylesheet"
        />
    </head>

    <body class="bg-dark text-white">
        <!-- Sidebar -->
        <div class="sidebar container pt-3 px-3">
            <h2>NoScord</h2>
            <div class="row" id="serverInfoContainer">
                <div
                    class="col-1 p-0"
                    style="max-width: 3px"
                    id="guildSelectionBarContainer"
                ></div>
                <div
                    class="col-3 px-0 d-flex justify-content-start align-items-center flex-column align-self-start"
                    id="guildContainer"
                >
                    <div
                        data-bs-toggle="tooltip"
                        data-bs-placement="right"
                        title="Ajouter un serveur"
                        id="openAddGuildModal"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="16"
                            height="16"
                            fill="currentColor"
                            class="bi bi-plus-square-fill avatar guild"
                            viewBox="0 0 16 16"
                        >
                            <path
                                d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm6.5 4.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3a.5.5 0 0 1 1 0"
                            />
                        </svg>
                    </div>
                </div>
                <div
                    class="col rounded-top pr-0 d-flex flex-column"
                    id="secondaryContainer"
                ></div>
            </div>
            <div class="userInfo mt-2">
                <div class="d-flex flex-row">
                    <div
                        id="userInformations"
                        class="d-flex flex-row rounded userInformations"
                        onclick="window.displayProfileInfo(this, localStorage.getItem('userId'))"
                    >
                        <img
                            id="userAvatar"
                            class="avatar"
                            src="/images/NoScord.jpg"
                        />
                        <div
                            class="d-flex flex-column justify-content-center mx-2"
                        >
                            <div id="userInfoUsername">
                                <span id="usernameDisplay"></span>
                            </div>
                            <div id="userInfoStatus">placeholder</div>
                        </div>
                    </div>
                    <div
                        class="position-relative mx-4 d-flex flex-row tool-container"
                    >
                        <div
                            class="align-self-center mx-1"
                            onclick="window.location.href = '/#'"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="16"
                                height="16"
                                fill="currentColor"
                                class="bi bi-gear-fill settings-button"
                                viewBox="0 0 16 16"
                            >
                                <path
                                    d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"
                                />
                            </svg>
                        </div>
                        <div class="align-self-center mx-1 rotate-return">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="16"
                                height="16"
                                fill="currentColor"
                                class="bi bi-mic-fill"
                                viewBox="0 0 16 16"
                            >
                                <path d="M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0z" />
                                <path
                                    d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5"
                                />
                            </svg>
                        </div>
                        <div class="align-self-center mx-1 rotate-return">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="16"
                                height="16"
                                fill="currentColor"
                                class="bi bi-person-fill-add"
                                viewBox="0 0 16 16"
                            >
                                <path
                                    d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0m-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"
                                />
                                <path
                                    d="M2 13c0 1 1 1 1 1h5.256A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1 1.544-3.393Q8.844 9.002 8 9c-5 0-6 3-6 4"
                                />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenu principal -->
        <div class="main-content">
            <div class="container mt-5">
                <div id="messageContainer">
                    <div
                        id="messageBox"
                        class="rounded mb-3 bg-dark text-white"
                    >
                        <ul
                            id="messageList"
                            class="list-group bg-dark text-white"
                        ></ul>
                    </div>

                    <div class="input-group">
                        <textarea
                            id="messageInput"
                            class="form-control bg-dark text-white"
                            style="resize: none"
                            placeholder="Envoyez un message"
                            rows="1"
                            maxlength="4096"
                        ></textarea>
                        <button
                            id="emojiButton"
                            class="btn"
                            style="border: 1px solid #ced4da"
                        >
                            ðŸ˜€
                        </button>
                        <button id="sendMessage" class="btn btn-primary">
                            Envoyer
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div
            class="modal fade"
            id="addGuildModal"
            tabindex="-1"
            aria-labelledby="addGuildModalLabel"
            aria-hidden="true"
        >
            <div class="modal-dialog">
                <div class="modal-content bg-dark text-white">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addGuildModalLabel">
                            Ajouter un serveur
                        </h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <!-- Contenu du modal -->
                        <form id="addServerForm">
                            <div class="mb-3">
                                <label for="guildName" class="form-label">
                                    Nom du serveur
                                </label>
                                <input
                                    type="text"
                                    class="form-control bg-dark text-white"
                                    id="guildName"
                                    placeholder="Entrez le nom du serveur"
                                    maxlength="32"
                                />
                            </div>
                            <div class="mb-3">
                                <label
                                    for="guildDescription"
                                    class="form-label"
                                >
                                    Description
                                </label>
                                <textarea
                                    class="form-control bg-dark text-white"
                                    style="resize: none"
                                    id="guildDescription"
                                    rows="3"
                                    maxlength="255"
                                    placeholder="Entrez une description"
                                ></textarea>
                            </div>
                            <div
                                class="d-flex flex-column justify-content-center align-items-center"
                            >
                                <p>Icone du serveur</p>
                                <div
                                    class="mb-3 text-center"
                                    style="width: 300px; height: 300px"
                                >
                                    <label
                                        for="guildIcon"
                                        class="form-label drop-container bg-dark text-white"
                                        id="dropcontainer"
                                    >
                                        <span class="drop-title">
                                            DÃ©poser vos fichiers
                                            <br />
                                            ou
                                        </span>
                                        <input
                                            type="file"
                                            class="custom-form-control"
                                            id="guildIcon"
                                            accept="image/*"
                                        />
                                    </label>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button
                                    type="button"
                                    class="btn btn-secondary"
                                    data-bs-dismiss="modal"
                                >
                                    Annuler
                                </button>
                                <button
                                    type="button"
                                    class="btn btn-primary"
                                    id="addGuildModalAccept"
                                >
                                    Ajouter
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div
            class="modal fade"
            id="addChannelModal"
            tabindex="-1"
            aria-labelledby="addChannelModalLabel"
            aria-hidden="true"
        >
            <div class="modal-dialog">
                <div class="modal-content bg-dark text-white">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addChannelModalLabel">
                            Ajouter un salon
                        </h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <!-- Contenu du modal -->
                        <form id="addChannelForm">
                            <div class="mb-3">
                                <label for="guildName" class="form-label">
                                    Nom du salon
                                </label>
                                <input
                                    type="text"
                                    class="form-control bg-dark text-white"
                                    id="channelName"
                                    placeholder="Entrez le nom du salon"
                                    maxlength="32"
                                    required
                                />
                            </div>
                            <div class="mb-3">
                                <label
                                    for="guildDescription"
                                    class="form-label"
                                >
                                    Description
                                </label>
                                <textarea
                                    class="form-control bg-dark text-white"
                                    style="resize: none"
                                    id="channelDescription"
                                    rows="3"
                                    maxlength="255"
                                    placeholder="Entrez une description"
                                ></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="channelType" class="form-label">
                                    type
                                </label>
                                <select
                                    class="form-select bg-dark text-white"
                                    id="channelType"
                                    required
                                >
                                    <option selected value="text">text</option>
                                    <option value="voice" disabled>
                                        voice
                                    </option>
                                </select>
                            </div>
                            <div class="modal-footer">
                                <button
                                    type="button"
                                    class="btn btn-secondary"
                                    data-bs-dismiss="modal"
                                >
                                    Annuler
                                </button>
                                <button
                                    type="button"
                                    class="btn btn-primary"
                                    id="addChannelModalAccept"
                                >
                                    Ajouter
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div
            id="contextMenu"
            class="context-menu dropdown-menu bg-dark text-white p-0"
        ></div>

        <div class="userProfileContainer pb-3">
            <div id="userProfileHeader" class="userProfileHeader"></div>
            <div class="userProfilePictureCircle">
                <img
                    id="userProfilePicture"
                    class="userProfilePicture"
                    src="/images/NoScord.jpg"
                    alt=""
                />
                <div class="presenceCircleBorder">
                    <div class="presenceCircle"></div>
                </div>
            </div>
            <div class="noteContainer">
                <p class="mx-2 my-1"></p>
            </div>
            <h4 class="px-3"></h4>
            <p id="statusText" class="pb-3 mx-2"></p>
            <div
                class="profileButtonContainer mx-4 d-flex flex-column justify-content-around"
                id="auxProfileButtonContainer"
            >
                <button class="text-white" id="editProfil">
                    Modifier le profil
                </button>
                <hr class="m-0" />
                <button
                    class="text-white"
                    id="changeAccount"
                    onclick="localStorage.removeItem('token');window.location.href ='/pages/login.html'"
                >
                    Changer de compte
                </button>
            </div>
            <div class="my-3"></div>
            <div
                class="profileButtonContainer mx-4 d-flex flex-column justify-content-around"
            >
                <button class="text-white" id="editPresence">
                    Changer la prÃ©sence
                </button>
                <hr class="m-0" id="mainProfileHorisontalBar" />
                <button class="text-white" id="copyIdentifier">
                    Copier l'identifiant
                </button>
            </div>
        </div>

        <script src="/js/libraries/styled-notifications-master/dist/notifications.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
        <script type="module" src="/js/index.js"></script>
        <script type="module" src="/js/components/emojiButton.js"></script>
        <script src="/js/utils/styleUtils.js"></script>
        <script type="module">
            const target = document.getElementById("secondaryContainer");
            const _contextMenu = document.getElementById("context-menu");
            import { ContextMenu } from "/js/utils/contextMenuUtils.js";
            const contextMenu = new ContextMenu(target, _contextMenu);
            contextMenu.addContextAction("Ajouter un salon", () => {
                const modal = new bootstrap.Modal(
                    document.getElementById("addChannelModal")
                );
                modal.show();
            });
            const addChannelAccept = document.getElementById(
                "addChannelModalAccept"
            );

            addChannelAccept.addEventListener("click", () => {
                const channelName =
                    document.getElementById("channelName").value;
                const channelDescription =
                    document.getElementById("channelDescription").value;
                const channelType =
                    document.getElementById("channelType").value;
                axios
                    .post("/channels/addChannel", {
                        type: channelType,
                        name: channelName,
                        description: channelDescription,
                        guildId: parseInt(
                            JSON.parse(localStorage.getItem("currentSession"))
                                .guild,
                            10
                        ),
                        token: localStorage.getItem("token"),
                    })
                    .catch((err) => {
                        console.log(err);
                    });
                const modal = bootstrap.Modal.getInstance(
                    document.getElementById("addChannelModal")
                );
                modal.hide();
            });
        </script>
    </body>
</html>
